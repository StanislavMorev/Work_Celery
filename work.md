üîπ 4. –£—á–µ–±–Ω—ã–µ —à–∞–≥–∏

–Ø –±—ã —Å–æ–≤–µ—Ç–æ–≤–∞–ª —Ç–∞–∫:

–ü—Ä–æ—Å—Ç–µ–π—à–∏–µ –∑–∞–¥–∞—á–∏

–°–∫–ª–∞–¥—ã–≤–∞—Ç—å —á–∏—Å–ª–∞, –∑–∞–¥–µ—Ä–∂–∫–∏ (time.sleep), –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä —Ä–µ–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ–Ω–µ.

–î–æ–ª–≥–∏–µ –∑–∞–¥–∞—á–∏

–°–¥–µ–ª–∞–π –∑–∞–¥–∞—á—É —Å time.sleep(10) –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ API –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

–°–µ—Ä–∏–π–Ω—ã–µ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

group, chain, chord ‚Üí Celery —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω—ã –∏–∑ –∑–∞–¥–∞—á.

Retry –∏ –æ—à–∏–±–∫–∏

–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç, –∏ –Ω–∞—É—á–∏—Å—å –¥–µ–ª–∞—Ç—å retry(countdown=5).

Monitoring

–£—Å—Ç–∞–Ω–æ–≤–∏ Flower (pip install flower) –∏ –∑–∞–ø—É—Å—Ç–∏:

celery -A app.celery_app flower


–¢–∞–º –±—É–¥–µ—Ç UI —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏.

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI

–°–¥–µ–ª–∞–π —ç–Ω–¥–ø–æ–∏–Ω—Ç /send_email ‚Üí –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É Celery.

–ü—Ä–æ–≤–µ—Ä—è–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ .get() –∏–ª–∏ —á–µ—Ä–µ–∑ backend.

üîπ 5. –ö–∞–∫ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç—å Celery (–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å¬ª)

–î—É–º–∞–π –Ω–µ –∫–∞–∫ ¬´–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è async¬ª, –∞ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π.

–ü–æ–π–º–∏, —á—Ç–æ Redis / RabbitMQ = ¬´–ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫¬ª, –∫—É–¥–∞ –∫–ª–∞–¥—É—Ç—Å—è –∑–∞–¥–∞—á–∏.

–ü–æ–π–º–∏, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä—ã = ¬´—Ä–∞–±–æ—Ç–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç–∞—é—Ç –ø–∏—Å—å–º–∞ –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏¬ª.

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π: –∑–∞–ø—É—Å—Ç–∏ 1 –≤–æ—Ä–∫–µ—Ä, –ø–æ—Ç–æ–º 3 –≤–æ—Ä–∫–µ—Ä–∞, –∏ —Å–º–æ—Ç—Ä–∏, –∫–∞–∫ –∑–∞–¥–∞—á–∏ –¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏ retry, ack, routing ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç Celery –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ ThreadPoolExecutor.



3. –í–∞–∂–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è (–±–µ–∑ –Ω–∏—Ö Celery –∫–∞–∂–µ—Ç—Å—è ¬´—á–µ—Ä–Ω–æ–π –º–∞–≥–∏–µ–π¬ª)

Broker ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Redis / RabbitMQ).

Backend ‚Äî –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Redis, DB, S3, RPC –∏ —Ç.–ø.).

Worker ‚Äî –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏.

Task ‚Äî –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –ø–æ–º–µ—á–µ–Ω–Ω–∞—è @celery_app.task.

delay / apply_async ‚Äî —Å–ø–æ—Å–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É.

Retry / Ack / Fail ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π.